
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
    <link rel="icon" sizes="16x16" href="../../../_static/favicon/favicon-16x16.jpg" type="image/jpeg">
    <link rel="icon" sizes="32x32" href="../../../_static/favicon/favicon-32x32.jpg" type="image/jpeg">
    <title>Topology Optimization with a Poisson Equation &#8212; cashocs 2.1.0-dev documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/cashocs.css?v=71b45df7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script src="../../../_static/documentation_options.js?v=14dbad98"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/demos/topology_optimization/demo_poisson_clover';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://cashocs.readthedocs.io/en/latest/_static/version_switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = true;
        </script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Topology Optimization with Linear Elasticity - Cantilever" href="demo_cantilever.html" />
    <link rel="prev" title="Topology Optimization Problems" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.jpg" class="logo__image only-light" alt="cashocs"/>
    <script>document.write(`<img src="../../../_static/logo.jpg" class="logo__image only-dark" alt="cashocs"/>`);</script>
  
  
    <p class="title logo__title">cashocs</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about/index.html">
                        About
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../development/index.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../release_notes.html">
                        Release Notes
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/sblauth/cashocs" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/cashocs/" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about/index.html">
                        About
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/index.html">
                        API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../development/index.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../release_notes.html">
                        Release Notes
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/sblauth/cashocs" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/cashocs/" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-box fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">List of tutorial topics:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../optimal_control/index.html">Optimal Control Problems</a><input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_poisson.html">Distributed Control of a Poisson Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/doc_config.html">Documentation of the Config Files for Optimal Control Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_box_constraints.html">Control Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_neumann_control.html">Neumann Boundary Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_multiple_variables.html">Using Multiple Variables and PDEs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_monolithic_problems.html">Coupled Problems - Monolithic Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_picard_iteration.html">Coupled Problems - Picard Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_stokes.html">Distributed Control of a Stokes Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_heat_equation.html">Distributed Control for Time Dependent Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_nonlinear_pdes.html">Optimal Control with Nonlinear PDE Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_dirichlet_control.html">Dirichlet Boundary Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_iterative_solvers.html">Iterative Solvers for State and Adjoint Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_state_constraints.html">Optimal Control with State Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_sparse_control.html">Sparse Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_scalar_control_tracking.html">Tracking of Scalar Functionals for Optimal Control Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_constraints.html">Treatment of additional constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_control_boundary_conditions.html">Boundary conditions for control variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimal_control/demo_pre_post_callbacks.html">Pre- and Post-Callbacks for the optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shape_optimization/index.html">Shape Optimization Problems</a><input checked class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_shape_poisson.html">Shape Optimization with a Poisson Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/doc_config.html">Documentation of the Config Files for Shape Optimization Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_regularization.html">Regularization for Shape Optimization Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_inverse_tomography.html">Inverse Problem in Electric Impedance Tomography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_shape_stokes.html">Optimization of an Obstacle in Stokes Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_remeshing.html">Remeshing with cashocs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_custom_scalar_product.html">Custom Scalar Products for Shape Gradient Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_scaling.html">Scaling of the Cost Functional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_eikonal_stiffness.html">Computing the Shape Stiffness via Distance to the Boundaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_p_laplacian.html">Shape Optimization with the p-Laplacian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_space_mapping_semilinear_transmission.html">Space Mapping Shape Optimization - Semilinear Transmission Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shape_optimization/demo_space_mapping_uniform_flow_distribution.html">Space Mapping Shape Optimization - Uniform Flow Distribution</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Topology Optimization Problems</a><input checked class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Topology Optimization with a Poisson Equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_cantilever.html">Topology Optimization with Linear Elasticity - Cantilever</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_pipe_bend.html">Topology Optimization with Stokes Flow - Pipe Bend</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_projection.html">Topology Optimization with a Volume Constraint</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cashocs_as_solver/index.html">Using cashocs as a solver</a><input checked class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../cashocs_as_solver/demo_control_solver.html">cashocs as Solver for Optimal Control Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cashocs_as_solver/demo_shape_solver.html">cashocs as Solver for Shape Optimization Problems</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../misc/index.html">Miscellaneous Topics</a><input checked class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../misc/demo_xdmf_io.html">Writing and Reading XDMF Files</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<nav class="sidebar-indices-items">
  <p class="sidebar-indices-items__title" role="heading" aria-level="1">Indices</p>
  <ul class="indices-link">
        <li class="toctree-l1">
          <a class="reference internal"
             href="../../../genindex.html"
             accesskey="I">General Index</a>
        </li>
        <li class="toctree-l1">
          <a class="reference internal" href="../../../py-modindex.html">Python Module Index</a>
        </li>
  </ul>
</nav></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">cashocs Tutorial</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Topology Optimization Problems</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Topology...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="topology-optimization-with-a-poisson-equation">
<span id="demo-poisson-clover"></span><h1>Topology Optimization with a Poisson Equation<a class="headerlink" href="#topology-optimization-with-a-poisson-equation" title="Link to this heading">#</a></h1>
<section id="solving-topology-optimization-problems-with-a-level-set-method">
<h2>Solving topology optimization problems with a level-set method<a class="headerlink" href="#solving-topology-optimization-problems-with-a-level-set-method" title="Link to this heading">#</a></h2>
<p>The general form of a topology optimization problem is given by</p>
<div class="math notranslate nohighlight">
\[
\min_\Omega J(\Omega),
\]</div>
<p>i.e., we want to minimize some cost functional <span class="math notranslate nohighlight">\(J\)</span> depending on a geometry or
set <span class="math notranslate nohighlight">\(\Omega\)</span> which is contained in some hold-all domain <span class="math notranslate nohighlight">\(\mathrm{D}\)</span> by
varying the topology and shape of <span class="math notranslate nohighlight">\(\Omega\)</span>. In contrast to shape optimization
problems we have discussed previously, topology optimization considers topological
changes of <span class="math notranslate nohighlight">\(\Omega\)</span>, i.e., the addition or removal of material.</p>
<p>One can represent the domain <span class="math notranslate nohighlight">\(\Omega\)</span> with a continuous level-set function <span class="math notranslate nohighlight">\(\Psi \colon \mathrm{D} \to \mathbb{R}\)</span> as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
    \Psi(x) &lt; 0 \quad &amp;\Leftrightarrow \quad x \in \Omega,\\
    \Psi(x) &gt; 0 \quad &amp;\Leftrightarrow \quad x \in \mathcal{D} \setminus \bar{\Omega},\\
    \Psi(x) = 0 \quad &amp;\Leftrightarrow \quad x \in \partial \Omega \setminus \partial \mathrm{D}.
\end{align}
\end{split}\]</div>
<p>Assuming that the topological derivative of the problem exists, which we denote by
<span class="math notranslate nohighlight">\(DJ(\Omega)\)</span>, then the generalized topological derivative is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathcal{D}J(\Omega)(x) =
    \begin{cases}
        -DJ(\Omega)(x) \quad &amp;\text{ if } x \in \Omega,\\
        DJ(\Omega)(x) \quad &amp;\text{ if } x \in \mathcal{D} \setminus \bar{\Omega}.
    \end{cases}
\end{split}\]</div>
<p>This is motivated by the fact that if there exists some constant <span class="math notranslate nohighlight">\(c &gt; 0\)</span> such
that</p>
<div class="math notranslate nohighlight">
\[
\mathcal{D}J(\Omega)(x) = c\Psi(x) \quad \text{ for all } x \in \mathrm{D},
\]</div>
<p>then we have that <span class="math notranslate nohighlight">\(DJ(\Omega) \geq 0\)</span> which is a necessary condition for
<span class="math notranslate nohighlight">\(\Omega\)</span> being a local minimizer of the problem.
According to this, several optimization algorithms have been developed in the
literature to solve topology optimization problems with level-set methods. We refer
the reader to <a class="reference external" href="https://doi.org/10.1007/s00158-023-03653-2">Blauth and Sturm - Quasi-Newton methods for topology optimization
using a level-set method</a> for a detailed
discussion of the algorithms implemented in cashocs.</p>
</section>
<section id="problem-formulation">
<h2>Problem Formulation<a class="headerlink" href="#problem-formulation" title="Link to this heading">#</a></h2>
<p>In this demo, we investigate the basics of using cashocs for solving topology
optimization problems with a level-set approach. This approachs goes back to
<a class="reference external" href="https://doi.org/10.1016/j.jcp.2005.12.015">Amstutz and Andrä - A new algorithm for topology optimization using a level-set
method</a> and in cashocs we have implemented
novel gradient-type and quasi-Newton methods for solving such problems from <a class="reference external" href="https://doi.org/10.1007/s00158-023-03653-2">Blauth
and Sturm - Quasi-Newton methods for topology optimization using a level-set
method</a>.</p>
<p>In this demo, we consider the following model problem</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
    &amp;\min_{\Omega,u} J(\Omega, u) = \frac{1}{2} \int_\mathrm{D} \left( u - u_\mathrm{des} \right)^2 \text{ d}x\\
    &amp;\text{subject to} \qquad
    \begin{alignedat}[t]{2}
        - \Delta u + \alpha_\Omega u &amp;= f_\Omega \quad &amp;&amp;\text{ in } \mathrm{D},\\
        u &amp;= 0 \quad &amp;&amp;\text{ on } \partial \mathrm{D}.
    \end{alignedat}
\end{align}
\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\alpha_\Omega\)</span> and <span class="math notranslate nohighlight">\(f_\Omega\)</span> have jumps between <span class="math notranslate nohighlight">\(\Omega\)</span>
and <span class="math notranslate nohighlight">\(\mathrm{D} \setminus \bar{\Omega}\)</span> and are given by
<span class="math notranslate nohighlight">\(\alpha_\Omega(x) = \chi_\Omega(x)\alpha_\mathrm{in} + \chi_{\Omega^c}(x) \alpha_\mathrm{out}\)</span> and <span class="math notranslate nohighlight">\(f_\Omega(x) = \chi_\Omega(x) f_\mathrm{in} + \chi_{\Omega^c}(x) f_\mathrm{out}\)</span> with <span class="math notranslate nohighlight">\(\alpha_\mathrm{in}, \alpha_\mathrm{out} &gt; 0\)</span> and <span class="math notranslate nohighlight">\(f_\mathrm{in}, f_\mathrm{out} \in \mathbb{R}\)</span>, and
<span class="math notranslate nohighlight">\(\Omega^c = \mathrm{D} \setminus \bar{\Omega}\)</span> is the complement of
<span class="math notranslate nohighlight">\(\Omega\)</span> in <span class="math notranslate nohighlight">\(\mathrm{D}\)</span>. Moreover, <span class="math notranslate nohighlight">\(u_\mathrm{des}\)</span> is a desired
state, which in our case comes from the solution of the state equation for a desired
shape, which we want to recover by the above problem. The generalized topological
derivative for this problem is given by</p>
<div class="math notranslate nohighlight">
\[
\mathcal{D}J(\Omega)(x) = (\alpha_\mathrm{in} - \alpha_\mathrm{out}) u(x)p(x)
- (f_\mathrm{in} - f_\mathrm{out})p(x),
\]</div>
<p>where <span class="math notranslate nohighlight">\(u\)</span> solves the state equation and <span class="math notranslate nohighlight">\(p\)</span> solves the adjoint equation.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>There is a typo in our paper <a class="reference external" href="https://doi.org/10.1007/s00158-023-03653-2">Blauth and Sturm - Quasi-Newton methods for topology
optimization using a level-set method</a>,
i.e., in the paper a minus sign is missing. The topological derivative as stated
here is, in fact, correct.</p>
</div>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<p>The complete python code can be found in the file <a class="reference download internal" download="" href="../../../_downloads/054bb56cc8e6ecfc0491e0912129b756/demo_poisson_clover.py"><code class="xref download docutils literal notranslate"><span class="pre">demo_poisson_clover.py</span></code></a>,
and the corresponding config can be found in <a class="reference download internal" download="" href="../../../_downloads/959d0eba918110fa89e1683ce3a1a4a0/config.ini"><code class="xref download docutils literal notranslate"><span class="pre">config.ini</span></code></a>.</p>
<section id="initialization-and-setup">
<h3>Initialization and setup<a class="headerlink" href="#initialization-and-setup" title="Link to this heading">#</a></h3>
<p>As usual, we start by using a wildcard import for FEniCS and by importing cashocs</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fenics</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">cashocs</span>
</pre></div>
</div>
<p>Next, as before, we can specify the verbosity of cashocs with the line</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cashocs</span><span class="o">.</span><span class="n">set_log_level</span><span class="p">(</span><span class="n">cashocs</span><span class="o">.</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</div>
<p>As with the other problem types, the solution algorithms of cashocs can be adapted
with the help of configuration files, which is loaded with the
<a class="reference internal" href="../../../api/generated/cashocs.html#cashocs.load_config" title="cashocs.load_config"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_config</span></code></a> function</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cashocs</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s2">&quot;config.ini&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the next step, we define the mesh used for discretization of the hold-all domain
<span class="math notranslate nohighlight">\(\mathrm{D}\)</span>. To do so, we use the built-in
<a class="reference internal" href="../../../api/generated/cashocs.html#cashocs.regular_box_mesh" title="cashocs.regular_box_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">regular_box_mesh</span></code></a>
function, which gives us a discretization of <span class="math notranslate nohighlight">\(\mathrm{D} = (-2, 2)^2\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomains</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">dS</span> <span class="o">=</span> <span class="n">cashocs</span><span class="o">.</span><span class="n">regular_box_mesh</span><span class="p">(</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">start_y</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">diagonal</span><span class="o">=</span><span class="s2">&quot;crossed&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now, we define the function spaces required for solving the state system, i.e., a
finite element space consisting of piecewise linear Lagrange elements, and we define
a finite element space consisting of piecewise constant elements, which is used to
discretize the jumping coefficients <span class="math notranslate nohighlight">\(\alpha_\Omega\)</span> and <span class="math notranslate nohighlight">\(f_\Omega\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">FunctionSpace</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;CG&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">DG0</span> <span class="o">=</span> <span class="n">FunctionSpace</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we define the level-set function used to represent our domain <span class="math notranslate nohighlight">\(\Omega\)</span> and
initialize <span class="math notranslate nohighlight">\(\Omega\)</span> to the empty set by setting <span class="math notranslate nohighlight">\(\Psi = 1\)</span> with the lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">psi</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">psi</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span><span class="o">.</span><span class="n">vec</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">psi</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="definition-of-the-jumping-coefficients">
<h3>Definition of the Jumping Coefficients<a class="headerlink" href="#definition-of-the-jumping-coefficients" title="Link to this heading">#</a></h3>
<p>We define the constants for the jumping coefficients as follows</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">alpha_in</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">alpha_out</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">DG0</span><span class="p">)</span>

<span class="n">f_in</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">f_out</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">DG0</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As the jumping coefficients <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(f\)</span> are piecewise constant for
each part of the considered domain, it is natural to represent them using piecewise
constant (in each mesh cell) functions from a discontinuous Lagrange FEM function
space. This approach is also mandatory for topology optimization. Note that cells,
which are “cut” by the level-set function, an average of the coefficients will be
computed, as detailed later.</p>
</div>
</section>
<section id="computation-of-the-desired-state">
<h3>Computation of the Desired State<a class="headerlink" href="#computation-of-the-desired-state" title="Link to this heading">#</a></h3>
<p>Next, we define the desired state <span class="math notranslate nohighlight">\(u_\mathrm{des}\)</span> for our problem by solving
the state system for a prescribed desired shape. This is done in the following
function. We first state the code below and then go over the function in more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_desired_state</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mf">5.0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">f_expr</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span>
        <span class="s2">&quot;0.1 * ( &quot;</span>
        <span class="o">+</span> <span class="s2">&quot;(sqrt(pow(x[0] - a, 2) + b * pow(x[1], 2)) - 1)&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;* (sqrt(pow(x[0] + a, 2) + b * pow(x[1], 2)) - 1)&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;* (sqrt(b * pow(x[0], 2) + pow(x[1] - a, 2)) - 1)&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;* (sqrt(b * pow(x[0], 2) + pow(x[1] + a, 2)) - 1)&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;- 0.001)&quot;</span><span class="p">,</span>
        <span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
        <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">psi_des</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">f_expr</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>

    <span class="n">cashocs</span><span class="o">.</span><span class="n">interpolate_levelset_function_to_cells</span><span class="p">(</span><span class="n">psi_des</span><span class="p">,</span> <span class="n">alpha_in</span><span class="p">,</span> <span class="n">alpha_out</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">cashocs</span><span class="o">.</span><span class="n">interpolate_levelset_function_to_cells</span><span class="p">(</span><span class="n">psi_des</span><span class="p">,</span> <span class="n">f_in</span><span class="p">,</span> <span class="n">f_out</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="n">y_des</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">y_des</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y_des</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">bcs</span> <span class="o">=</span> <span class="n">cashocs</span><span class="o">.</span><span class="n">create_dirichlet_bcs</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">boundaries</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

    <span class="n">cashocs</span><span class="o">.</span><span class="n">newton_solve</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">y_des</span><span class="p">,</span> <span class="n">bcs</span><span class="p">,</span> <span class="n">is_linear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">y_des</span><span class="p">,</span> <span class="n">psi_des</span>
</pre></div>
</div>
<div class="admonition-descripion-of-the-python-define-desired-state-function admonition">
<p class="admonition-title">Descripion of the <code class="code highlight python docutils literal highlight-python"><span class="n">define_desired_state</span></code> function</p>
<p>The above code starts with defining a level-set function based on a clover-type
shape, hence the name of this demo, which is done with the lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="mf">5.0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">f_expr</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span>
    <span class="s2">&quot;0.1 * ( &quot;</span>
    <span class="o">+</span> <span class="s2">&quot;(sqrt(pow(x[0] - a, 2) + b * pow(x[1], 2)) - 1)&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;* (sqrt(pow(x[0] + a, 2) + b * pow(x[1], 2)) - 1)&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;* (sqrt(b * pow(x[0], 2) + pow(x[1] - a, 2)) - 1)&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;* (sqrt(b * pow(x[0], 2) + pow(x[1] + a, 2)) - 1)&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;- 0.001)&quot;</span><span class="p">,</span>
    <span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">psi_des</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">f_expr</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
</pre></div>
</div>
<p>Note, that this level-set function is taken from the <a class="reference external" href="https://docu.ngsolve.org/latest/i-tutorials/unit-7-optimization/04_Topological_Derivative_Levelset.html%3E">NGSolve Tutorials</a></p>
<p>Then, the values of the jumping coefficients <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(f\)</span> are
computed for this level-set function, using the
<a class="reference internal" href="../../../api/generated/cashocs.html#cashocs.interpolate_levelset_function_to_cells" title="cashocs.interpolate_levelset_function_to_cells"><code class="xref py py-func docutils literal notranslate"><span class="pre">interpolate_levelset_function_to_cells</span></code></a>, which sets the piecewise
constant functions <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">f</span></code> to the appropriate values according to the
level-set function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cashocs</span><span class="o">.</span><span class="n">interpolate_levelset_function_to_cells</span><span class="p">(</span><span class="n">psi_des</span><span class="p">,</span> <span class="n">alpha_in</span><span class="p">,</span> <span class="n">alpha_out</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="n">cashocs</span><span class="o">.</span><span class="n">interpolate_levelset_function_to_cells</span><span class="p">(</span><span class="n">psi_des</span><span class="p">,</span> <span class="n">f_in</span><span class="p">,</span> <span class="n">f_out</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, the state system corresponding to the desired shape is written out and
solved with cashocs using the lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_des</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">y_des</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y_des</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">bcs</span> <span class="o">=</span> <span class="n">cashocs</span><span class="o">.</span><span class="n">create_dirichlet_bcs</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">boundaries</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">cashocs</span><span class="o">.</span><span class="n">newton_solve</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">y_des</span><span class="p">,</span> <span class="n">bcs</span><span class="p">,</span> <span class="n">is_linear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">return</span> <span class="n">y_des</span><span class="p">,</span> <span class="n">psi_des</span>
</pre></div>
</div>
<p>and in the end, the desired state is returned together with the desired level-set
function (the latter is only used for visualization purposes).</p>
</div>
<p>Now, the function we defined previously is called to compute the desired state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_des</span><span class="p">,</span> <span class="n">psi_des</span> <span class="o">=</span> <span class="n">create_desired_state</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="definition-of-the-state-problem-cost-functional-and-topological-derivative">
<h3>Definition of the State Problem, Cost Functional, and Topological Derivative<a class="headerlink" href="#definition-of-the-state-problem-cost-functional-and-topological-derivative" title="Link to this heading">#</a></h3>
<p>Next, we define the state problem, i.e., the PDE constraint for our minimization
problem, with the lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">bcs</span> <span class="o">=</span> <span class="n">cashocs</span><span class="o">.</span><span class="n">create_dirichlet_bcs</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">boundaries</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">cashocs</span><span class="o">.</span><span class="n">IntegralFunctional</span><span class="p">(</span><span class="n">Constant</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_des</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we define the generalized topological derivative of the problem, which is given
above. In python code, this can be done as follows</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dJ_in</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">alpha_in</span> <span class="o">-</span> <span class="n">alpha_out</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="n">Constant</span><span class="p">(</span><span class="n">f_in</span> <span class="o">-</span> <span class="n">f_out</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<span class="n">dJ_out</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">alpha_in</span> <span class="o">-</span> <span class="n">alpha_out</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="n">Constant</span><span class="p">(</span><span class="n">f_in</span> <span class="o">-</span> <span class="n">f_out</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We remark that the generalized topological derivative for this problem is identical
in <span class="math notranslate nohighlight">\(\Omega\)</span> and <span class="math notranslate nohighlight">\(\Omega^c\)</span>, which is usually not the case. For this
reason, the special structure of the problem can be exploited with the following
lines in the configuration file</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">config.ini</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[TopologyOptimization]</span>
<span class="na">topological_derivative_is_identical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we have to define what happens, when the geometry, i.e., the level-set
function is updated. Of course, a change in the level-set function changes the
geometry, so that the jumping coefficients <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(f\)</span> have to be
updated. This is, as before, done with the function
<a class="reference internal" href="../../../api/generated/cashocs.html#cashocs.interpolate_levelset_function_to_cells" title="cashocs.interpolate_levelset_function_to_cells"><code class="xref py py-func docutils literal notranslate"><span class="pre">interpolate_levelset_function_to_cells</span></code></a>, which is called twice, once
for updating <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and once for <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_level_set</span><span class="p">():</span>
    <span class="n">cashocs</span><span class="o">.</span><span class="n">interpolate_levelset_function_to_cells</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">alpha_in</span><span class="p">,</span> <span class="n">alpha_out</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">cashocs</span><span class="o">.</span><span class="n">interpolate_levelset_function_to_cells</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">f_in</span><span class="p">,</span> <span class="n">f_out</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="definition-and-solution-of-the-topology-optimization-problem">
<h3>Definition and Solution of the Topology Optimization Problem<a class="headerlink" href="#definition-and-solution-of-the-topology-optimization-problem" title="Link to this heading">#</a></h3>
<p>Now, defining a topology optimization problem is nearly as easy as defining a shape
optimization or optimal control problem, namely we instantiate a
<a class="reference internal" href="../../../api/generated/cashocs.html#cashocs.TopologyOptimizationProblem" title="cashocs.TopologyOptimizationProblem"><code class="xref py py-class docutils literal notranslate"><span class="pre">TopologyOptimizationProblem</span></code></a> and
then can call it’s
<a class="reference internal" href="../../../api/generated/cashocs.html#cashocs.TopologyOptimizationProblem.solve" title="cashocs.TopologyOptimizationProblem.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve</span></code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">=</span> <span class="n">cashocs</span><span class="o">.</span><span class="n">TopologyOptimizationProblem</span><span class="p">(</span>
    <span class="n">F</span><span class="p">,</span> <span class="n">bcs</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">dJ_in</span><span class="p">,</span> <span class="n">dJ_out</span><span class="p">,</span> <span class="n">update_level_set</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">cfg</span>
<span class="p">)</span>
<span class="n">top</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">angle_tol</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note, that there are several algorithms available for solving such topology
optimization problems. Among them are the usual “sphere combination” method of
<a class="reference external" href="https://doi.org/10.1016/j.jcp.2005.12.015">Amstutz and Andrä - A new algorithm for topology optimization using a level-set
method</a>, which is invoked with
<code class="docutils literal notranslate"><span class="pre">algorithm=&quot;sphere_combination&quot;</span></code>, a convex combination approach, invoked with
<code class="docutils literal notranslate"><span class="pre">algorithm=&quot;convex_combination&quot;</span></code>, and all optimizaton algorithms available for shape
optimization, i.e., gradient descent (<code class="docutils literal notranslate"><span class="pre">algorithm=&quot;gd&quot;</span></code>), nonlinear CG
(<code class="docutils literal notranslate"><span class="pre">algorithm=&quot;ncg&quot;</span></code>) and L-BFGS (<code class="docutils literal notranslate"><span class="pre">algorithm=&quot;bfgs&quot;</span></code>) methods. For a comparison of these
optimization algorithms, we refer the reader to <a class="reference external" href="https://doi.org/10.1007/s00158-023-03653-2">Blauth
and Sturm - Quasi-Newton methods for topology optimization using a level-set
method</a></p>
</div>
<p>We visualize the results with the following code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax_mesh</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">top</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Obtained shape&quot;</span><span class="p">)</span>

<span class="n">ax_u</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">psi</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span><span class="o">.</span><span class="n">vec</span><span class="p">()</span><span class="o">.</span><span class="n">aypx</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">psi_des</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span><span class="o">.</span><span class="n">vec</span><span class="p">())</span>
<span class="n">psi</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">top</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Desired shape&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.savefig(&quot;./img_poisson_clover.png&quot;, dpi=150, bbox_inches=&quot;tight&quot;)</span>
</pre></div>
</div>
<p>and the result looks like this
<img alt="" src="../../../_images/img_poisson_clover.png" />
As we can see, the BFGS method is able to reconstruct the desired clover shape after
only about 100 iterations. We encourage readers to try the other (established) methods
to compare the novel BFGS approach to established techniques and see that the new
methods are significantly more efficient.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <a class="reference internal" href="../../../api/generated/cashocs.html#cashocs.TopologyOptimizationProblem.plot_shape" title="cashocs.TopologyOptimizationProblem.plot_shape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot_shape</span></code></a> can
be used to visualize the current shape based on the level-set function <code class="docutils literal notranslate"><span class="pre">psi</span></code>. Note
that the cells inside <span class="math notranslate nohighlight">\(\Omega\)</span> are colored in yellow and the ones outside are
colored blue.</p>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Topology Optimization Problems</p>
      </div>
    </a>
    <a class="right-next"
       href="demo_cantilever.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Topology Optimization with Linear Elasticity - Cantilever</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">

  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-topology-optimization-problems-with-a-level-set-method">Solving topology optimization problems with a level-set method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-formulation">Problem Formulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization-and-setup">Initialization and setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-the-jumping-coefficients">Definition of the Jumping Coefficients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computation-of-the-desired-state">Computation of the Desired State</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-the-state-problem-cost-functional-and-topological-derivative">Definition of the State Problem, Cost Functional, and Topological Derivative</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-and-solution-of-the-topology-optimization-problem">Definition and Solution of the Topology Optimization Problem</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/user/demos/topology_optimization/demo_poisson_clover.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2020-2024, Sebastian Blauth.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>